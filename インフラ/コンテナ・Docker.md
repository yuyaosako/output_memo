# コンテナ・Docker周りの整理
## 【コンテナの基礎】
- 従来の課題
    - OSやライブラリ、FW、他アプリケーションやDBなどが環境ごとによって異なる。
        - この環境差異が原因で他の環境では動くが、本番では動かない等の事象が発生することが課題だった。
- コンテナの利点
    - コンテナ技術により、アプリケーションの実行基盤はコンテナを動かせばよいだけとなり、環境差異が生まれなくなった。
        - 開発環境と本番環境、各自のローカル環境など。
    - 各種モジュールやライブラリなどを各自が個々でダウンロードする必要がない。
- コンテナイメージ：OS + アプリケーション環境を1つのパッケージイメージとしてまとめたもの。
- コンテナ：コンテナイメージを展開したもの。

- コンテナアプリケーション開発のライフサイクル
    1. Build：OSとアプリケーション環境を1つのコンテナイメージにすること。
        - Dockerfileを記述し、イメージを作成する工程。
        - 従来であれば実行環境がコンパイルして実行ファイルを作成する工程。
    2. Ship：コンテナイメージを移動、共有すること。
        - Push：完成したコンテナイメージをイメージレジストリ(Docker Hubなど)に格納する。
        - Pull：コンテナプラットフォームから取り込む。
    3. Run：コンテナイメージを展開して稼働させること。

## 【Dockerコマンド(頻繁に利用するもののみ)】
- `docker image build`
    - Dockerfileに記述した内容を上から順番に処理していく。
    - リポジトリ名を付けないとpushできない。
        -t コンテナイメージ名 Dockerfileパス
- `docker container ls オプション`
    - build or pullしたコンテナイメージの確認
    - -a : Exitedも含めたすべてのイメージを確認できる
- `docker container run`
    - イメージを元にコンテナを起動する。
    - Dockerfileで定義されたCMDやENTRYPOINT命令でアプリケーションが実行されている状態。
    - --name : 起動するコンテナに名前を付ける
    - -d : バックグラウンドで起動する
    - -p : ポート指定(ホストポート : コンテナポート)
        - 8080 : 80の場合、ホストの8080ポートにアクセスするとコンテナ上で動作している80番ポートにアクセスできる。
- `docker container exec -it コンテナ名 or ID`
    - 稼働しているコンテナに接続する。
    - -it : 標準出力を開いたままにできるため、対話的な入力が可能。デフォルトで設定してよい。
- `docker container stop`
    - 稼働しているコンテナを停止する
- `docker container start`
    - 停止したコンテナを起動する。
- `docker container restart`
    - コンテナを再起動する
    - runはコンテナ作成から起動、startは作成済みコンテナの起動、restartは起動中コンテナの再起動。
- `docker container cp コンテナホストのコピー元パス コンテナ名orID：コンテナ内のコピー先パス`
    - 稼働中にコンテナでホストとファイルのやり取りをする。
    - コンテナ同士の場合は別コマンドを利用する。
- `docker container rm`
    - コンテナを停止して削除する
- `docker history イメージ名`
    - イメージを生成する時のコマンド実行を確認する。

- コンポーネント
    - Docker Engine(Dockerのコア機能)
    - Docker Registry(イメージ公開・共有)
    - Docker Compose(複数コンテナ一元管理)
    - Docker Machine(Docker実行環境構築)
    - Docker Swarm(クラスタ管理)

- コンテナイメージの軽量化
    - DockerfileのFrom命令のみで参照可能なscratchなどの軽量なベースイメージの利用
    - コマンドの連結(1行ずつ実行されるため、実行行は少ない方が良い。)
        - RUN ○○ && ●●　など
        - ※最初は1行ずつ書いてトライ＆エラーをした後、まとめる。

## 【Dockerfile】
- FROM(必須項目)
    - ベースイメージの設定
    - タグ名を省略したときはベースイメージのlatestが適用される。
- RUN(最も使う)
    - FROMで指定したベースイメージに対するコマンド実行
        - 例：ライブラリのインストール、ミドルウェアの設定、環境構築のためのコマンド実行　など
    - ①Shell形式での記述
        - コンテナ内で/bin/sh -c を使ってコマンド実行した時と同じ挙動。
        - `RUN apt-get install -y nginx`  など
    - ②Exec形式での記述
        - `RUN ["/bin/bash", "-c", "apt-get install -y nginx"]`  など
        - 引数で文字列を指定するときはシングルクォーテを使う。
            - `RUN ["/bin/bash", "-c", "echo 'Hello World' "]`  など
        - コマンド引数に$PYTHONのような環境変数の指定はできない。
- COPY：localにあるファイルやディレクトリを配置する場合に使用。
    - COPY <配置元>・・・ <配置先>
- ADD：リモートファイルやtarファイルを配置する場合に使用。

## 課題
- 仮想マシンとの違いは？
- ハイパーバイザーとは？
- カーネルとは？
- マルチステージビルドについて
- CI/CDについて
- VscodeのdevContainerについて