# API関連の整理

## 理解

- モバイルアプリやwebサイトなど、1つの実装で複数のコンシューマから利用することが可能。

- APIは組み合わせて色々と使えるからこそ、新規参画者や外部公開した時に使用しやすいような設計をすることが必要。

- APIは何ができるのかが分かればよく、その中身に関しては利用者には関係ない。

- API設計する際、コンシューマ(利用するユーザとソフトウェア)の視点に焦点を合わせることが礎となる。

- API設計時に考慮するポイント
    - 誰が使えるのか？
    - 何ができるのか？
    - それをどのように行うのか？
    - そのために何が必要か？
    - 何が返されるのか？

- APIの内容がデータ構造とほぼイコールになっていたらプロバイダ視点に立っている可能性が高いので再考が必要。

- プロバイダ視点での設計出の弊害は、コンシューマとは無関係な部分をAPIが曝け出すことに関連している。

- REST APIではメインリソースに結び付く動詞に注目する。<br>商品をカタログに追加する。の場合、カタログの追加アクションで、商品はパラメータ。

- 同じリソースを返すAPIだとしても、戻り値として必要最低限のデータのみ渡すため、その中身のデータまでが必ず一緒とは限らない。
    - 但し、原則的に同じ変数として期待することが大半のため、特別な理由がない限りは同一の変数名を使用する。

- 実装をRESTに準拠させるのが難しい場合は、アクションリソースを使用したりする選択肢もあるが、いずれもコンシューマ視点を忘れない。

- RESTfulに保つためには以下の6点に注意すべき。
    1. クライアントとサーバーの分離
    2. ステートレス性
        - requestの実行に必要な全ての情報がrequest自体に含まれてなければならない。
    3. キャッシュ可能性
    4. 階層化システム
        - クライアントからは1つの層が見えるのみとする。（裏にあるストラクチャは気にしない）
    5. コードオンデマンド
    6. 統一インターフェース
        - 全てのやり取りを識別されたリソースに従って行う。(一意なパスと標準化されたHTTPメソッドを使用など) 
        - メタデータも全て提供する。

- DBの値をそのまま返すのではなく、使用しやすいようにデータ型やデータフォーマットには気を遣うべき。
    - DBでは1, 2, 3等の数値コードを使っていたとしても、responseには"code1の値","code2の値"などの文字列にするとか。
        - 数値コードがなんらかの理由で必要な場合は両方返すなども良い。
    - 12345という数値なども桁数が決まっていれば"00012345"にするとか。
    - APIドキュメントを見れば型も分かるため、長くなるならパラメターなどに型を示す文言はなくても良い。
        - 寧ろユーザフレンドリにし、ユーザが分かりやすい変数名を使用するべき。

- 1つのrequestで複数のエラーが発生している場合は包括的なフィードバックを1度で返すべき。

- エラーを予め分析し、回避する方法を実装しておくことも必要。
    - エラー回避できるような付加価値を持つデータを突き止める。
    - 上記を提供する新しいゴールを作成する。（responseに含むのかAPIを作成するのか）

- 一貫性を図ることが大事。一貫性のレベルとしては以下などがある。
    1. API内部での一貫性
    2. 組織内のAPIにまたがる一貫性
    3. APIの問題領域での一貫性
    4. 外界・世間一般との一貫性

## 疑問
- APIの粒度は？
- コードオンデマンドとは？
- 外部公開しない場合にAPIを利用するメリットは？